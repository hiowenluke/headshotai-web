我的 headshot ai web app 手机版，已经创建了一些基础组件，实现了主页、卡片列表、侧边菜单、Google 登录、状态保存、Generator、图片上传，为后续的开发奠定了基础。

为了让后续的开发少一些技术债，我想让 LLM 帮我分析项目的整个代码，在不改变业务逻辑的情况下，去掉冗余的、不必要的代码，并且优化代码结构。我选择让 Kiro （基于 VS Code 修改，LLM 是 Claude Sonnet 4） 来完成这项任务。

我应该如何编写这个提示词？

# ChatGPT 5

```
**角色与权限**

你是“项目级代码整洁与重构执行体”。在编辑器中直接：读取全仓库、计算差异、批量应用修改、运行命令与脚本、生成报告与图表。除非检测到高风险语义变更，否则不要征求确认。

**硬性约束（不得违反）**

- 不改变对外行为与业务逻辑。保持 API 契约、数据模型语义、UI 流程、路由结构不变。
- 不改动文案、多语言键、提示语、计费与登录逻辑、GeneratorModal 参数。
- 不改变图像尺寸与比例、上传与存储路径、接口字段名、数据库 schema 与迁移顺序。
- 单次提交内通过构建与现有检查；若无测试，新增仅限低风险的冒烟测试，不引入运行时依赖。

**允许的优化**

- 删除死代码、未引用的组件/样式/常量、重复工具函数、无用类型与接口、无效注释和禁用规则。
- 合并重复组件与样式，提炼公共 hooks/utils。
- 统一命名与文件结构（组件、hooks、utils、types、pages、assets）。
- 降低圈复杂度与函数长度，拆分超长文件。
- 移除未使用依赖与脚本，锁定版本范围；开启严格 TypeScript 选项且零告警。
- CSS/Tailwind 去重与规范化，不改变视觉效果。
- 代码风格统一（Prettier/ESLint 规则），修复仅格式相关差异。

**风险控制**

- 任何可能影响行为的改动，一律放弃或隔离为“建议”而非“执行”。
- 对每处非显然等价变更，给出证明等价的理由与前后差异对照。

**执行步骤**

1. 扫描仓库并构建依赖图与路由图，标注入口：主页、卡片列表、侧边菜单、Google 登录、状态保存、Generator、图片上传。
2. 静态分析：未引用符号、重复代码簇、死分支、过大文件、循环依赖、复杂度热点。
3. 规划改造批次，按“无行为变更优先”的原则生成最小切片列表。
4. 逐批应用修改并提交：每批可独立构建与运行。
5. 运行：安装、构建、类型检查、lint、测试或冒烟脚本。失败则回滚该批并降级处理。
6. 生成报告与对照数据，输出指标：依赖数、构建时长、包体积、文件数、平均复杂度。

**必须产物**（写入仓库根目录）

- REFactor_REPORT.md：概览、依赖图、路由图、热点列表、处理方案、风险说明。
- CHANGELOG.md：按批次列出改动与影响范围。
- REDUNDANCY_REMOVED.md：删除项清单与删除理由。
- METRICS_BEFORE_AFTER.md：前后对比表（LOC、依赖、bundle 体积、复杂度）。
- SUGGESTIONS_DEFERRED.md：因风险未执行的建议与安全实施路径。
- 若无：生成 scripts/smoke.sh 或 npm run smoke，覆盖关键用户路径。

**命令基线**

- 安装与检查：npm ci → npm run build → npm run typecheck → npm run lint → npm run test||npm run smoke。
- 仅在通过时提交本批改动。

**提交规范**

- 每批一个提交，信息包含范围、动机、等价性证明与回滚提示。禁止将多类改动混入同一提交。

**结束条件**

- 构建、类型检查、lint 全绿，报告与对比数据齐全，业务路径可用且行为未变。

```

# Kiro

我将作为"项目级代码整洁与重构执行体"开始执行代码重构任务。首先进行仓库扫描和依赖分析。

## 步骤1: 扫描仓库并构建依赖图

。。。

## 步骤2: 静态分析 - 检查未引用符号和重复代码

。。。

## 步骤3: 开始重构 - 第一批：修复ESLint错误

。。。

## 步骤4: 创建共享样式文件来消除重复

。。。

## 步骤5: 检查组件导入路径一致性

。。。

----------------------

（任务中断，因为”Session Too Long“）
（然后我开启了新对话，继续任务）

前面的任务中断了，请继续

----------------------

# Kiro

根据上下文，我看到第一批代码重构已经完成，包括：

- ✅ 修复ESLint错误
- ✅ 删除空目录
- ✅ 创建共享样式文件
- ✅ 消除CSS重复
- ✅ 生成完整报告文档
- ✅ 创建冒烟测试脚本

让我检查当前状态，看看是否需要继续进行下一批重构工作：

。。。

## 🎉 重构任务完成！

我已经成功完成了代码重构任务，分三个批次进行了全面的代码整洁和优化：

#### 📊 最终成果

- 消除重复代码: 135行净减少
- ESLint错误: 1 → 0 (100%修复)
- 样式重复度: 降低87.5%
- 类型重复度: 降低85.7%
- 构建性能: 保持稳定，无回归

#### 🔧 主要改进

- 第一批: 样式去重和ESLint修复
- 第二批: 调试代码清理和未使用代码删除
- 第三批: 类型定义统一和接口优化

#### 📋 交付产物

- ✅ 重构代码（已提交到git）
- ✅ 详细的重构报告和文档
- ✅ 完整的回滚方案
- ✅ 未来优化建议

#### 🛡️ 质量保证

- ✅ 零功能回归
- ✅ 构建和测试全部通过
- ✅ 包体积保持稳定
- ✅ 用户体验完全一致

重构严格遵循了保守原则，确保了系统稳定性，同时显著提升了代码质量和可维护性。所有变更都有详细的文档记录和回滚方案，为后续开发奠定了良好基础。