问题：

当 AdaptiveContentArea 的宽度、高度之比小于 4:5（也即，接近正方形），那么卡片就会显示不全，卡片下部被裁剪，这不符合预期。

因此，你需要先判断 AdaptiveContentArea 区域的形状，然后用合理的方式，计算卡片的高度，然后再计算卡片的宽度，确保卡片能完全显示。

## Sonnet 4：

我理解问题了！当 `AdaptiveContentArea` 的形状接近正方形或比较矮胖时（宽高比 < 4:5），使用 1.25 的高宽比会导致卡片高度太高，从而被裁剪。

。。。

## 🎯 形状感知的自适应卡片尺寸算法

### 核心改进：

1. **形状判断机制**：

   - 计算容器宽高比：`containerRatio = width / height`
   - 临界比例：`4:5 = 0.8`
   - 根据形状选择不同的计算策略

2. **双策略计算**：

   **策略A：瘦高/正方形容器** (`containerRatio < 0.8`)

   - 🎯 **优先保证高度完整显示**
   - 先设置 `cardHeight = maxCardHeight`
   - 再计算 `cardWidth = cardHeight / 1.25`
   - 检查宽度是否超限，如超限则反向调整

   **策略B：宽扁容器** (`containerRatio >= 0.8`)

   - 🎯 **优先保证宽度完整显示**
   - 先设置 `cardWidth = maxCardWidth`
   - 再计算 `cardHeight = cardWidth * 1.25`
   - 检查高度是否超限，如超限则反向调整

### 解决的问题：

- ✅ **防止裁剪**：在接近正方形的容器中，卡片不再被裁剪
- ✅ **最大化利用空间**：根据容器形状智能选择最优尺寸
- ✅ **保持比例**：始终维持 1.25 的高宽比
- ✅ **双向保护**：两个方向都有边界检查
- ✅ **自适应响应**：容器形状变化时自动切换策略

### 实际效果：

- 📱 **窄屏/竖屏**：优先确保卡片高度不被裁剪
- 🖥️ **宽屏/横屏**：优先确保卡片宽度充分利用
- ⚡ **动态响应**：屏幕旋转或窗口调整时自动适配
- 🎯 **完美显示**：任何形状的容器都能完整显示所有卡片

现在无论 `AdaptiveContentArea` 的形状如何，卡片都能完美适配并充分利用可用空间！